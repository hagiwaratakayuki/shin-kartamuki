<!DOCTYPE html>
<html>

<head>

    <title>Quick Start - Leaflet</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>
    <style>

        .map-label {
        position: absolute;
  bottom: 0;left: -50%;
  display: flex;
  flex-direction: column;
  text-align: center;
}
/*Wrap the content of the divicon (text) in this class*/
.map-label-content {
  order: 1;
  position: relative; left: -50%;
  white-space: nowrap;
  font-size: 20px;
  color:blue;
}
    </style>



</head>

<body>



    <div id="map" style="width:100%; height: 400px;"></div>
    <script>

       var map = L.map('map', {
            center: [35.66018818015924, 139.7060675777756],
            zoom: 17,
        }); 

      var tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© <a href="http://osm.org/copyright">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
        
        });
        tileLayer.addTo(map);
        tileLayer.on('load', loadJson)

        function reqListener() {
            datas = JSON.parse(this.responseText);
            maxLength = 0;
            minLength = -1;
                
            for (let slope of datas.slopes) {
                slen = (slope.vector.lat ** 2 + slope.vector.lon ** 2) ** 0.5
                if (slen > maxLength) {
                    maxLength = slen;
                }
                if(slen < minLength || minLength === -1){
                    minLength = slen;

                }
                slope.slen  = slen
            }
            let lRange = (maxLength - minLength)
            for (let slope of datas.slopes) {
                let pos = new L.LatLng(slope.coord.lat, slope.coord.lon);
                let transform = '';
               
                let deg = 90 - Math.atan2(slope.vector.lat, slope.vector.lon) * 180 / Math.PI;
                transform += 'rotate(' + deg + 'deg) ';

                
                let yScale = 0.1 + 1.9 *(slope.slen - minLength) / lRange;
                transform += 'scale(1,' + yScale  +')' 

                var icon = L.divIcon({
                    iconSize: null,
                    html: '<div class="map-label" style="transform:' + transform + '"><div class="map-label-content">▲</div></div>'
                });
                /*
                var icon = L.divIcon({
                    iconSize: null,
                    html: '<div class="map-label"><div class="map-label-content">▲</div><div class="map-label-arrow"></div></div>'
                });*/
                
                L.marker(pos, { icon: icon }).addTo(map);
            }

        }
        function loadJson() {

        
            var oReq = new XMLHttpRequest();
            oReq.addEventListener("load", reqListener);
            oReq.open("GET", "./result/result.json");
            oReq.send();
        }

    </script>



</body>

</html>